<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Réservations</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f4f4f4;
      }

      h1 {
        color: #333;
      }

      ul {
        list-style-type: none;
        padding: 0;
      }

      li {
        background-color: #fff;
        margin-bottom: 15px;
        padding: 10px;
        border-radius: 5px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .reservation-detail {
        margin-bottom: 8px;
      }

      .plats-reserves {
        font-weight: bold;
        color: #2c3e50;
      }

      .back-link {
        display: inline-block;
        margin-top: 20px;
        padding: 10px 15px;
        background-color: #2980b9;
        color: #fff;
        text-decoration: none;
        border-radius: 5px;
      }

      .back-link:hover {
        background-color: #3498db;
      }
    </style>
  </head>

  <body>
    <h1>Réservations pour {{ email if email else 'tous les clients' }}</h1>
    <ul>
      {% if reservations_with_plats %}
      {% for reservation, plats in reservations_with_plats %}
      <li>
        <div class="reservation-detail">
          <strong>Référence :</strong> {{ reservation.reference or 'N/A' }}
        </div>
        <div class="reservation-detail">
          <strong>Nom :</strong> {{ reservation.nom }}
        </div>
        <div class="reservation-detail">
          <strong>Email :</strong> {{ reservation.email }}
        </div>
        <div class="reservation-detail">
          <strong>Téléphone :</strong> {{ reservation.telephone }}
        </div>
        <div class="reservation-detail">
          <strong>Date :</strong> {{ reservation.date }}
        </div>
        <div class="reservation-detail">
          <strong>Heure :</strong> {{ reservation.heure }}
        </div>
        <div class="reservation-detail">
          <strong>Nombre de personnes :</strong> {{ reservation.personnes }}
        </div>
        <div class="reservation-detail">
          <strong>Statut :</strong> 
          <span class="badge bg-{{ 'success' if reservation.statut == 'confirmee' else 'warning' if reservation.statut == 'en_attente' else 'danger' }}">
            {{ reservation.statut|replace('_', ' ')|title }}
          </span>
        </div>
        {% if reservation.message %}
        <div class="reservation-detail">
          <strong>Message :</strong> {{ reservation.message }}
        </div>
        {% endif %}
        
        <div class="reservation-actions" style="margin-top: 15px;">
          {% if reservation.statut == 'en_attente' %}
            <form action="{{ url_for('reservation.changer_statut', id=reservation.id) }}" method="post" style="display: inline-block; margin-right: 5px;">
              <input type="hidden" name="nouveau_statut" value="confirmee">
              <button type="submit" class="btn btn-success btn-sm" style="padding: 5px 10px; border: none; border-radius: 4px; color: white; cursor: pointer; background-color: #28a745;">
                <i class="bi bi-check-lg"></i> Confirmer
              </button>
            </form>
            <form action="{{ url_for('reservation.changer_statut', id=reservation.id) }}" method="post" style="display: inline-block;">
              <input type="hidden" name="nouveau_statut" value="annulee">
              <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Êtes-vous sûr de vouloir annuler cette réservation ?')" style="padding: 5px 10px; border: none; border-radius: 4px; color: white; cursor: pointer; background-color: #dc3545;">
                <i class="bi bi-x-lg"></i> Annuler
              </button>
            </form>
          {% elif reservation.statut == 'confirmee' %}
            <span class="badge" style="background-color: #28a745; color: white; padding: 5px 10px; border-radius: 4px;">
              <i class="bi bi-check-circle"></i> Confirmée
            </span>
          {% else %}
            <span class="badge" style="background-color: #dc3545; color: white; padding: 5px 10px; border-radius: 4px;">
              <i class="bi bi-x-circle"></i> Annulée
            </span>
          {% endif %}
        </div>

        <div class="plats-reserves">
          <strong>Plats réservés :</strong>
          {% if plats %}
          <ul>
            {% for plat in plats %}
            <li>
              <div><strong>Nom du plat :</strong> {{ plat[0] }}</div>
              <div><strong>Description :</strong> {{ plat[1] }}</div>
              <div><strong>Prix :</strong> {{ plat[2] }} €</div>
            </li>
            {% endfor %}
          </ul>
          {% else %} Menu de jour. {% endif %}
        </div>
      </li>
      {% endfor %} {% else %}
      <li>Menu de jour.</li>
      {% endif %}
    </ul>
    <a href="{{ url_for('accueil') }}" class="back-link">Retour à l'accueil</a>
  </body>
</html>
